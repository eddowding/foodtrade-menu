<section data-ng-controller="SearchController" id="searchWrapper">

	<div class="container-responsive" role="main" id="main">

		<div class='row'>
			<div class="col-xs-7">
				<form class="form-horizontal innerTB innerL">
					<fieldset>
						<!-- BUSINESS input-->
						<div class="form-group">
							<label class="col-sm-3 col-md-2 control-label" for="name">Business name</label>
							<div class="col-sm-9 col-md-10">
								<input id="name" name="name" type="search" ng-model='query.businessName' placeholder="eg Black Horse" class="form-control input-md">
							</div>
						</div>

						<!-- DISH input-->
						<div class="form-group">
							<label class="col-sm-3 col-md-2 control-label" for="dish">Dish / food</label>
							<div class="col-sm-9 col-md-10">
								<input id="dish" name="dish" type="search" placeholder="eg 'Lasagne'" class="form-control input-md" ng-model='query.dish'>
							</div>
						</div>


						<!-- HAS MENU -->
						<div class="form-group">
							<label class="col-sm-3 col-md-2 control-label" for="hasmenu">Menu </label>
							<div class="col-sm-9 col-md-10">
								<label class="checkbox-inline" for="hasmenu-0">
									<input type="checkbox" name="hasmenu" id="hasmenu-0" value=""> Only results with a menu
								</label>
							</div>
						</div>

						<span class="btn btn-default btn-sm" data-toggle="collapse" data-target="#advsearch" style="background: white; margin-bottom: 10px;"  ng-show='hits.length'>
							<i class="fa fa-sliders"></i>
							More Filters
						</span>



						<div id="advsearch" class="collapse">

							<!-- LOCATION -->
							<div class="form-group">
								<label class="col-sm-3 col-md-2 control-label" for="location">Location</label>
								<div class="col-sm-9 col-md-10">
									<input id="location" name="location" type="search" placeholder="eg 'Bristol'" class="form-control input-md">
								</div>
							</div>


							<!-- BIZ TYPE Checkboxes -->
							<div class="form-group">
								<label class="col-sm-3 col-md-2 control-label" for="businesstype">Business type</label>
								<div class="col-sm-9 col-md-10">
									<div class="checkbox-inline">
										<label for="businesstype-0">
											<input type="checkbox" name="businesstype" id="businesstype-0" value=""> list
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="businesstype-1">
											<input type="checkbox" name="businesstype" id="businesstype-1" value=""> from
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="businesstype-2">
											<input type="checkbox" name="businesstype" id="businesstype-2" value=""> fsa
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="businesstype-3">
											<input type="checkbox" name="businesstype" id="businesstype-3" value=""> data
										</label>
									</div>
								</div>
							</div>

							<!-- Multiple Checkboxes -->
							<div class="form-group">
								<label class="col-sm-3 col-md-2 control-label" for="Rating">Rating</label>
								<div class="col-sm-9 col-md-10">
									<div class="checkbox-inline">
										<label for="Rating-0">
											<input type="checkbox" name="Rating" id="Rating-0" value="5"> 5 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-1">
											<input type="checkbox" name="Rating" id="Rating-1" value="4"> 4 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-2">
											<input type="checkbox" name="Rating" id="Rating-2" value="3"> 3 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-3">
											<input type="checkbox" name="Rating" id="Rating-3" value="2"> 2 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-4">
											<input type="checkbox" name="Rating" id="Rating-4" value="1"> 1 star
										</label>
									</div>
								</div>
							</div>

							<!-- Multiple Checkboxes -->
							<div class="form-group">
								<label class="col-sm-3 col-md-2 control-label" for="Rating">Hygiene</label>
								<div class="col-sm-9 col-md-10">
									<div class="checkbox-inline">
										<label for="Rating-0">
											<input type="checkbox" name="Rating" id="Rating-0" value="5"> 5 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-1">
											<input type="checkbox" name="Rating" id="Rating-1" value="4"> 4 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-2">
											<input type="checkbox" name="Rating" id="Rating-2" value="3"> 3 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-3">
											<input type="checkbox" name="Rating" id="Rating-3" value="2"> 2 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-4">
											<input type="checkbox" name="Rating" id="Rating-4" value="1"> 1 star
										</label>
									</div>
								</div>
							</div>

							<!-- Multiple Checkboxes -->
							<div class="form-group">
								<label class="col-sm-3 col-md-2 control-label" for="Rating">Confidence in management</label>
								<div class="col-sm-9 col-md-10">
									<div class="checkbox-inline">
										<label for="Rating-0">
											<input type="checkbox" name="Rating" id="Rating-0" value="5"> 5 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-1">
											<input type="checkbox" name="Rating" id="Rating-1" value="4"> 4 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-2">
											<input type="checkbox" name="Rating" id="Rating-2" value="3"> 3 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-3">
											<input type="checkbox" name="Rating" id="Rating-3" value="2"> 2 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-4">
											<input type="checkbox" name="Rating" id="Rating-4" value="1"> 1 star
										</label>
									</div>
								</div>
							</div>

							<!-- Multiple Checkboxes -->
							<div class="form-group">
								<label class="col-sm-3 col-md-2 control-label" for="Rating">Structural</label>
								<div class="col-sm-9 col-md-10">
									<div class="checkbox-inline">
										<label for="Rating-0">
											<input type="checkbox" name="Rating" id="Rating-0" value="5"> 5 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-1">
											<input type="checkbox" name="Rating" id="Rating-1" value="4"> 4 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-2">
											<input type="checkbox" name="Rating" id="Rating-2" value="3"> 3 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-3">
											<input type="checkbox" name="Rating" id="Rating-3" value="2"> 2 stars
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="Rating-4">
											<input type="checkbox" name="Rating" id="Rating-4" value="1"> 1 star
										</label>
									</div>
								</div>
							</div>



							<!-- Button Drop Down -->
							<div class="form-group">
								<label class="col-sm-3 col-md-2 control-label" for="inspection">Last inspected</label>
								<div class="col-sm-9 col-md-10">
									<div class="input-group">
										<input id="inspection" name="inspection" class="form-control" placeholder="date" type="text">
										<div class="input-group-btn">
											<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
												Before this date
												<span class="caret"></span>
											</button>
											<ul class="dropdown-menu pull-right">
												<li><a href="#">Before this date</a></li>
												<li><a href="#">After this date</a></li>
											</ul>
										</div>
									</div>
								</div>
							</div>

							<!-- Multiple Checkboxes -->
							<div class="form-group">
								<label class="col-sm-3 col-md-2 control-label" for="diet">Diet choices</label>
								<div class="col-sm-9 col-md-10">
									<div class="checkbox-inline">
										<label for="diet-0">
											<input type="checkbox" name="diet" id="diet-0" value=""> MSC fish
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="diet-1">
											<input type="checkbox" name="diet" id="diet-1" value=""> Locally sourced
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="diet-2">
											<input type="checkbox" name="diet" id="diet-2" value=""> Vegetarian options
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="diet-3">
											<input type="checkbox" name="diet" id="diet-3" value=""> Vegan options
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="diet-4">
											<input type="checkbox" name="diet" id="diet-4" value=""> Organic
										</label>
									</div>
								</div>
							</div>

							<!-- Multiple Checkboxes -->
							<div class="form-group">
								<label class="col-sm-3 col-md-2 control-label" for="allergies">Allergies</label>
								<div class="col-sm-9 col-md-10">
									<div class="checkbox-inline">
										<label for="allergies-0">
											<input type="checkbox" name="allergies" id="allergies-0" value=""> Nuts
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="allergies-1">
											<input type="checkbox" name="allergies" id="allergies-1" value=""> Peanuts
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="allergies-2">
											<input type="checkbox" name="allergies" id="allergies-2" value=""> Sesame seeds
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="allergies-3">
											<input type="checkbox" name="allergies" id="allergies-3" value=""> Fish
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="allergies-4">
											<input type="checkbox" name="allergies" id="allergies-4" value=""> Crustaceans
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="allergies-5">
											<input type="checkbox" name="allergies" id="allergies-5" value=""> Molluscs
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="allergies-6">
											<input type="checkbox" name="allergies" id="allergies-6" value=""> Eggs
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="allergies-7">
											<input type="checkbox" name="allergies" id="allergies-7" value=""> Milk
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="allergies-8">
											<input type="checkbox" name="allergies" id="allergies-8" value=""> Cereals cont. gluten
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="allergies-9">
											<input type="checkbox" name="allergies" id="allergies-9" value=""> Lupin
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="allergies-10">
											<input type="checkbox" name="allergies" id="allergies-10" value=""> Celery
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="allergies-11">
											<input type="checkbox" name="allergies" id="allergies-11" value=""> Mustard
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="allergies-12">
											<input type="checkbox" name="allergies" id="allergies-12" value=""> Soya
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="allergies-13">
											<input type="checkbox" name="allergies" id="allergies-13" value=""> Sulphur dioxide
										</label>
									</div>
									<div class="checkbox-inline">
										<label for="allergies-14">
											<input type="checkbox" name="allergies" id="allergies-14" value=""> Other
										</label>
									</div>
								</div>
							</div>

						</div>


					</fieldset>
				</form>

				<div ng-hide='isSearchView' class="innerTB innerL">

					<a ng-click='showSearchViewFn()'><i class="fa fa-chevron-left"></i> Back to results</a>
					<hr />
					<div class="single">

						<div class="locationimage" style="background-image: url('http://i.telegraph.co.uk/multimedia/archive/02674/MINISTER_2674488b.jpg');">
							<h4 class="media-heading">
								<a>{{detailViewHit._source.BusinessName}}</a>
								<rating ng-model="detailViewHit._source.RatingValue" max="5" readonly="true"></rating>
								<span class="" data-toggle="collapse" data-target="#ratingInfo">
									<i class="fa fa-info-circle"></i>
								</span>

							</h4>
						</div>


						<span class="label label-default  ">{{detailViewHit._source.BusinessType || 'Restaurant'}}</span>
						<small>
							{{getAddressByEstablishmentFn(detailViewHit)}}
						</small>
						<div class="collapse" id="ratingInfo">
							<div id="FSAinfo">
								<dl>
									<dt>
										Hygiene
									</dt>
									<dd class="ng-binding">
										{{detailViewHit._source.scores.Hygiene}}
									</dd>
									<dt>
										Structural
									</dt>
									<dd class="ng-binding">
										{{detailViewHit._source.scores.Structural}}
									</dd>
									<dt>
										Confidence in management
									</dt>
									<dd class="ng-binding">
										{{detailViewHit._source.scores.ConfidenceInManagement}}
									</dd>
								</dl>
							</div>

						</div>
						<div class="btn-group btn-group-justified">
							<!--
							<a class="btn btn-default action">
								<i class="fa fa-phone"></i> Call
							</a>
							<a class="btn btn-default action">
								<i class="fa fa-globe"></i> Website
							</a> -->
							<a class="btn btn-default action" ng-href='https://www.google.com/maps/dir/Current+Location/{{detailViewHit._source.geocode[1]}},{{detailViewHit._source.geocode[0]}}' target="_blank">
								<i class="fa fa-location-arrow"></i> Directions
							</a>
						</div>
						<div class="menu" ng-show='detailViewHit._source.grids.length'>
							<section ng-repeat='grid in detailViewHit._source.grids' ng-show='grid.tableData.length'>
								<h4>{{grid.name}}</h4>
								<div class="menuitem" ng-repeat='entry in grid.tableData'>

									<h5>
										{{entry.item.name}}
										<span class="price"> £{{entry.item.price || 0}}</span>
									</h5>
									<p class="text-muted ingredients">
										<span ng-hide='value.allergenType == "No allergen"' ng-repeat='(key, value) in entry' ng-class='{"allergen": value.allergenType == "Fixed" || value.allergenType == "Removable"}'>{{key}} <span ng-show='value.allergens'>({{value.allergens}})</span></span>
									</p>
									<p class="tags" ng-show='entry.item.characteristic.length'>
										<i class="fa fa-tags text-muted"></i>
										<a ng-repeat='tag in entry.item.characteristic'>{{tag.text}}</a>
									</p>
								</div>
							</section>
							<pre ng-hide='detailViewHit._source.grids.length'>
								if no menu.. upload a photo (camera, mobile) email us a phioto add twitter email for biz add tags claim
							</pre>
						</div>
					</div>

					<hr />
				</div>
				<div ng-show='isSearchView' id="results" class="innerTB innerL">
					<!-- <div class='row' ng-hide='hits.length'>
						No matches, please search something else.
					</div> -->


					<div class='result' ng-repeat='hit in hits' ng-show='hits.length' ng-click='showDetailViewFn(hit)'>
						<div class="media">
							<!-- <a href="#" class="pull-right">
								<img alt="Bootstrap Media Preview" src="http://lorempixel.com/64/64/" class="media-object">
							</a> -->
							<div class="media-body">
								<h4 >
									<a ng-click='showDetailViewFn(hit)'>{{hit._source.BusinessName}}</a>
									<rating ng-model="hit._source.RatingValue" max="5" readonly="true" class="pull-right"></rating>
								</h4>
								<p class="small tag ">{{hit._source.BusinessType || 'Restaurant'}}</p>
								<div class="menu" ng-show='hit.inner_hits'>
									<section>
										<div class="menuitem" ng-repeat='entry in hit.inner_hits["grids.tableData"].hits.hits'>

											<h5>
												{{entry._source.item.name}}
												<span class="price"> £{{entry._source.item.price || 0}}</span>
											</h5>
											<p class="text-muted ingredients">
												<span ng-hide='value.allergenType == "No allergen"' ng-repeat='(key, value) in entry._source' ng-class='{"allergen": value.allergenType == "Fixed" || value.allergenType == "Removable"}'>{{key}} <span ng-show='value.allergens'>({{value.allergens}})</span></span>
											</p>
											<p class="tags" ng-show='entry._source.item.characteristic.length'>
												<i class="fa fa-tags text-muted"></i>
												<a ng-repeat='tag in entry._source.item.characteristic'>{{tag.text}}</a>
											</p>
										</div>
									</section>
								</div>
								<!-- <p class="small">
									{{getAddressByEstablishmentFn(hit)}}
								</p> -->
								<!-- <div class="btn-group btn-group-sm" style="margin-top: 10px;">

									<button class="btn btn-default" type="button">
										<i class="fa fa-phone"></i> Call
									</button>
									<button class="btn btn-default" type="button">
										<i class="fa fa-globe"></i> Website
									</button>
									<a ng-href='https://www.google.com/maps/dir/Current+Location/{{hit._source.geocode[1]}},{{hit._source.geocode[0]}}' target="_blank">
										<i class="fa fa-location-arrow"></i> Directions
									</a>
								</div> -->
							</div>
						</div>
					</div>
					<div class='row' ng-show='hits.length'>
						<pagination total-items="totalItems" ng-model="currentPage" ng-change="pageChanged()" items-per-page='pageLimit'></pagination>
					</div>
				</div>


			</div>
			<div class="col-xs-5" id="mapWrapper">
				<ui-gmap-google-map center='map.center' zoom='map.zoom' control='mapControl' pan='true' refresh='true'>
					<ui-gmap-markers models="hitMarkers" coords="'self'" idkey="'id'" doRebuildAll=true fit=true events="markerEvents" control='markerControl'>
						<ui-gmap-windows>
							<div ng-non-bindable>{{title}}</div>
							<a ng-href='https://www.google.com/maps/dir/Current+Location/{{latitude}},{{longitude}}' target="_blank">
								<i class="fa fa-location-arrow"></i> Directions
							</a>
							</ui-gmap-window>
					</ui-gmap-markers>
				</ui-gmap-google-map>
			</div>
		</div>
	</div>
</section>
